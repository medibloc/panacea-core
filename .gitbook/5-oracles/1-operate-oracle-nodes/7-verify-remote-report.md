# Verify Remote Report

# Genesis Oracle

- Status: Draft
- Created: 2023-01-12
- Modified: 2023-01-12
- Authors
    - Gyuguen Jang <gyuguen.jang@medibloc.org>
    - Youngjoon Lee <yjlee@medibloc.org>
    - Hansol Lee <hansol@medibloc.org>
    - Myongsik Gong <myongsik_gong@medibloc.org>
    - Inchul Song <icsong@medibloc.org>


## Synopsis

This document describes how to validate remote reports generated by Oracle.

## Remote Report

Remote reports are one of the core of our protocol. This remote report must be submitted when the genesis oracle or new oracle participant registers with Panacea. A remote report can verify that the genesis oracle or new oracle participant is the correct oracle. 

- For the remote report generated by the genesis oracle, you can see [genesis oracle](./3-genesis-oracle.md) section. 
- For the remote report generated by the new oracle registration, you can see [oracle registration](./4-oracle-registration.md) section.
- How to verify correct oracle via remote report, you can see [confidential oracle](../../3-protocol-devs/1-dep-specs/5-confidential-oracle.md) section.

### Validation a genesis oracle

To verify the genesis oracle, you need an oracle public key and a remote report generated based on that oracle public key. This information can be obtained from Panacea's oracle module parameters.
You need to create `public_key_info.json` file through the process below.
```shell
ORACLE_PUBLIC=$(panacead q oracle params --node <node-rpc-address> -o json)
ORACLE_PUBLIC_KEY=$(panacead q oracle params --node <node-rpc-address> -o json | jq -r .params.oracle_public_key)
ORACLE_PUBLIC_REMOTE_REPORT=$(panacead q oracle params --node <node-rpc-address> -o json | jq -r .params.oracle_pub_key_remote_report)

jq -n --arg public_key_base64 $ORACLE_PUBLIC_KEY --arg remote_report_base64 $ORACLE_PUBLIC_REMOTE_REPORT '{public_key_base64: $public_key_base64, remote_report_base64: $remote_report_base64}' > public_key_info.json
```

**oracle_public_key_info.json**
```json
{
  "public_key_base64": "<public-key-base64>",
  "remote_report_base64": "<remote-report-base64>"
}
```

Move the generated json file to the oracle home path and perform remote report validation.
```shell
mv ./oracle_public_key_info.json <directory-you-want>/.oracle

docker run \
    --device /dev/sgx_enclave \
    --device /dev/sgx_provision \
    -v <directory-you-want>:/oracle \
    ghcr.io/medibloc/panacea-oracle:main \
    ego run /usr/bin/oracled verify-report /home_mnt/.oracle/oracle_public_key_info.json
```

**Output**
```
time="2023-01-12T01:45:45Z" level=info msg="remote report is verified successfully"
```

### Validation a new oracle registration

To verify a newly registered oracle, the public key of the node registered by this oracle and the remote report are required. This information can be found in oracle registration store on Panacea.

```shell
ORACLE_REGISTRATION=$(panacead q oracle oracle-registration <unique-id> <oracle-address> --node <node-rpc-address> -o json)
NODE_PUBLIC_KEY=$(echo $ORACLE_REGISTRATION | jq -r .oracle_registration.node_pub_key)
NODE_PUBLIC_REMOTE_REPORT=$(echo $ORACLE_REGISTRATION | jq -r .oracle_registration.node_pub_key_remote_report)

jq -n --arg public_key_base64 $NODE_PUBLIC_KEY --arg remote_report_base64 $NODE_PUBLIC_REMOTE_REPORT '{public_key_base64: $public_key_base64, remote_report_base64: $remote_report_base64}' > node_public_key_info.json
```

Move the generated json file to the oracle home path and perform remote report validation.
```shell
mv ./node_public_key_info.json <directory-you-want>/.oracle

docker run \
    --device /dev/sgx_enclave \
    --device /dev/sgx_provision \
    -v <directory-you-want>:/oracle \
    ghcr.io/medibloc/panacea-oracle:main \
    ego run /usr/bin/oracled verify-report /home_mnt/.oracle/oracle_public_key_info.json
```

**Output**
```shell
time="2023-01-12T01:45:45Z" level=info msg="remote report is verified successfully"
```